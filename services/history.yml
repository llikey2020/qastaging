variables:
  HISTORY_SERVICE_NAME: history
  HISTORY_PROJECT_ID: 55

History server helm prepare:
  extends:
    - .helm-prepare
  rules:
    - if: '($DEPLOY_PROJECT == "history" || $DEPLOY_PROJECT == "all") && $ONLY_CLEANUP == "false"'
  variables:
    SERVICE_NAME: ${HISTORY_SERVICE_NAME}
    PACKAGE_NAME: history-server-helm-chart
    FILE_NAME: history-server-0.1.0.tgz
    PACKAGE_VERSION: "0.1.0"
    ID: ${HISTORY_PROJECT_ID}
  script:
    - !reference [".helm-prepare", "script"]
    - |
      cat << EOF > ${OVERRIDES_FILE}
      eventLog:
        alluxioService: ${ALLUXIO_MASTER_SERVICE}
        alluxioRpcPort: ${ALLUXIO_RPC_PORT}
        dir: ${SPARK_EVENTLOG_DIR}
      imagePullSecrets:
        - name: ${PULL_SECRET}
      image:
        repository: ${REGISTRY}/${SPARK_PROJECT}
        tag: ${SPARK_IMAGE_TAG}
        pullPolicy: Always
      fullnameOverride: ${HISTORY_SERVICE_NAME}
      EOF
